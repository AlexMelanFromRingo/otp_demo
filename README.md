# HOTP Demo — RFC 4226

> Інтерактивна демонстрація алгоритму HOTP (HMAC-based One-Time Password) для навчальних цілей.

🌐 **[Відкрити демо](https://alexmelanfromringo.github.io/otp_demo/)**

## Що це?

Це навчальний проект, який наочно демонструє роботу алгоритму одноразових паролів HOTP, описаного в [RFC 4226](https://datatracker.ietf.org/doc/html/rfc4226) (грудень 2005).

Демо розділене на два вікна:
- **🖥️ Сервер** — показує, як сервер зберігає секретний ключ, лічильник та перевіряє паролі
- **📱 Клієнт** — показує, як токен генерує одноразові паролі

## Структура проекту

```
otp_demo/
├── index.html          # Головний HTML файл
├── styles.css          # Стилі (світла/темна тема)
├── README.md           # Ця документація
│
├── js/
│   ├── app.js          # Точка входу, ініціалізація
│   ├── hotp.js         # Реалізація алгоритму HOTP (RFC 4226)
│   ├── base32.js       # Base32 кодування/декодування
│   ├── i18n.js         # Інтернаціоналізація (UK/EN/RU)
│   ├── theme.js        # Керування темами
│   └── ui.js           # DOM взаємодії та візуалізація
│
└── .github/
    └── workflows/
        └── deploy.yml  # GitHub Pages деплой
```

## Алгоритм HOTP

### Формула

```
HOTP(K, C) = Truncate(HMAC-SHA1(K, C)) mod 10^Digit
```

Де:
- `K` — секретний ключ (мінімум 128 біт, рекомендовано 160 біт = 20 байт)
- `C` — 8-байтний лічильник (big-endian)
- `Digit` — кількість цифр у OTP (зазвичай 6)

### Кроки алгоритму

#### Крок 1: Підготовка лічильника
```
counter = 5
counter_bytes = 0x0000000000000005  (8 байт, big-endian)
```

#### Крок 2: HMAC-SHA1
```
hmac = HMAC-SHA1(secret_key, counter_bytes)
// Результат: 20 байт
```

#### Крок 3: Динамічне обрізання (Dynamic Truncation)
```
offset = hmac[19] & 0x0F              // Останній півбайт → зміщення (0-15)
binary = hmac[offset..offset+4]       // Витягуємо 4 байти
binary[0] &= 0x7F                     // Обнуляємо старший біт
code = binary as u32                  // 31-бітне число
```

#### Крок 4: Модуло
```
otp = code mod 1000000                // 6-значний код
otp = otp.padStart(6, '0')            // Додаємо нулі зліва
```

## Структура даних

### На клієнті (токен)

```
┌─────────────────────────────────────────────────────────────┐
│ ТОКЕН / МОБІЛЬНИЙ ДОДАТОК                                   │
├─────────────────────────────────────────────────────────────┤
│ Захищена пам'ять:                                           │
│   secret_key: [u8; 20]  // Секретний ключ                   │
│                                                             │
│ Звичайна пам'ять:                                           │
│   counter: u64          // Лічильник (збільшується після    │
│                         // кожної генерації)                │
└─────────────────────────────────────────────────────────────┘
```

### На сервері

```
┌─────────────────────────────────────────────────────────────┐
│ СЕРВЕР АУТЕНТИФІКАЦІЇ                                       │
├─────────────────────────────────────────────────────────────┤
│ База даних:                                                 │
│   user_id: INTEGER                                          │
│   username: VARCHAR                                         │
│   secret_key: BLOB (20 байт, шифрований)                    │
│   counter: BIGINT (останній успішний)                       │
│   failed_attempts: INTEGER                                  │
│                                                             │
│ Конфігурація:                                               │
│   look_ahead_window: 5  // Вікно допуску                    │
│   max_failed_attempts: 3                                    │
└─────────────────────────────────────────────────────────────┘
```

## Потік аутентифікації

```
  КЛІЄНТ                              СЕРВЕР
     │                                   │
     │  1. Генерація OTP                 │
     │     OTP = HOTP(K, C)              │
     │     C = C + 1                     │
     │                                   │
     │  2. Відправка                     │
     │─────────────────────────────────► │
     │   username + OTP                  │
     │                                   │
     │                    3. Верифікація │
     │                       for i in 0..window:
     │                         if HOTP(K, C+i) == OTP:
     │                           C = C + i + 1
     │                           return SUCCESS
     │                                   │
     │  4. Відповідь                     │
     │◄─────────────────────────────────│
     │   SUCCESS / FAILURE              │
```

## HOTP vs TOTP

| Характеристика | HOTP (RFC 4226) | TOTP (RFC 6238) |
|---------------|-----------------|-----------------|
| Рік | 2005 | 2011 |
| Основа | Лічильник | Час |
| Синхронізація | Вікно допуску | Автоматична |
| Термін дії OTP | До використання | ~30 секунд |
| Фізичний токен | Ідеально | Потрібен годинник |

## Локальний запуск

```bash
# Клонування
git clone https://github.com/AlexMelanFromRingo/otp_demo.git
cd otp_demo

# Запуск локального сервера (потрібен для ES modules)
python3 -m http.server 8000
# або
npx serve .

# Відкрити в браузері
open http://localhost:8000
```

## Безпека

⚠️ **Це навчальний проект!** Не використовуйте цей код у production без:

- Шифрування секретного ключа в базі даних
- Rate limiting (обмеження спроб)
- Безпечного каналу передачі (HTTPS)
- Захисту від timing attacks
- Аудит логів

## Тестові вектори RFC 4226

Секретний ключ: `"12345678901234567890"` (ASCII)

| Counter | HOTP |
|---------|------|
| 0 | 755224 |
| 1 | 287082 |
| 2 | 359152 |
| 3 | 969429 |
| 4 | 338314 |
| 5 | 254676 |
| 6 | 287922 |
| 7 | 162583 |
| 8 | 399871 |
| 9 | 520489 |

## Посилання

- [RFC 4226 — HOTP Algorithm](https://datatracker.ietf.org/doc/html/rfc4226)
- [RFC 6238 — TOTP Algorithm](https://datatracker.ietf.org/doc/html/rfc6238)
- [OATH — Open Authentication](https://openauthentication.org/)

## Ліцензія

MIT
